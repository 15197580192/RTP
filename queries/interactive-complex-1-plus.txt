MATCH (p:Person {id: "13778"}), (friend:Person)
       WHERE NOT p=friend
       WITH p, friend
       MATCH path = shortestPath((p)-[:knows*1..3]-(friend))
       WITH min(length(path)) AS distance, friend
ORDER BY
    friend.lastName ASC,
    toInteger(friend.id) ASC
OPTIONAL MATCH (friend:Person)-[workAt:workAt]->(company:Organisation)
WITH friend, collect(
    CASE
        WHEN company IS NULL then null
        ELSE [company.name, workAt.workFrom, company.id]
    END ) AS companies,distance
RETURN
    friend.id AS friendId,
    friend.lastName AS friendLastName,
    friend.birthday AS friendBirthday,
    friend.creationDate AS friendCreationDate,
    friend.gender AS friendGender,
    friend.browserUsed AS friendBrowserUsed,
    friend.locationIP AS friendLocationIp,
    friend.email AS friendEmails,
    friend.speaks AS friendLanguages,
    distance AS distanceFromPerson,
    companies AS friendCompanies
LIMIT 20

MATCH (friend:Person)-[:isLocatedIn]->(friendCity:Place)
OPTIONAL MATCH (friend:Person)-[studyAt:studyAt]->(uni:Organisation)-[:isLocatedIn]->(uniCity:Place)
WITH friend, collect(
    CASE
        WHEN uni IS NULL THEN null
        ELSE [uni.name, studyAt.classYear, uniCity.name]
    END ) AS unis,friendCity
RETURN unis, friend.id, friendCity.name AS friendCityName
ORDER BY
    friend.lastName ASC,
    toInteger(friend.id) ASC


OPTIONAL MATCH (company:Organisation)-[:isLocatedIn]->(companyCountry:Place)
RETURN companyCountry, company.id